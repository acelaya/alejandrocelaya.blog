/**
 * @typedef {import('remark-mdx')}
 * @typedef {import('rehype-infer-description-meta')}
 */

/** @type {import('unified').Plugin<[], import('hast').Root>} */
export function rehypeMdxPluginPostSummary() {
  return (tree, file) => {
    // This is generated by rehype-infer-description-meta
    const value = file.data.meta?.description;

    if (typeof value !== 'string') {
      return;
    }

    tree.children.unshift({
      type: 'mdxjsEsm',
      value: '',
      data: {
        estree: {
          type: 'Program',
          sourceType: 'module',
          body: [
            {
              type: 'ExportNamedDeclaration',
              source: null,
              specifiers: [],
              declaration: {
                type: 'VariableDeclaration',
                kind: 'const',
                declarations: [
                  {
                    type: 'VariableDeclarator',
                    id: { type: 'Identifier', name: 'summary' },
                    init: { type: 'Literal', value }
                  }
                ]
              }
            }
          ]
        }
      }
    })
  }
}
